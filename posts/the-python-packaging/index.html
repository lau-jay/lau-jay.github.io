<!doctype html><html lang=zh-CN><head><title>The Python Packaging - 世界的过客</title>
<meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="The HTML5 Herald"><meta name=author content="Jay Lau"><meta property="og:title" content="The Python Packaging"><meta property="og:description" content="名字 Python的模块或者包名应该遵循下面几条:
总是小写 pypi上唯一 不要用中划线分隔，下划线或者干脆不要分隔单词 最小结构 jay_hello/ jay_hello/ __init__."><meta property="og:type" content="article"><meta property="og:url" content="https://laujay.com/posts/the-python-packaging/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-05-14T08:39:47+08:00"><meta property="article:modified_time" content="2020-05-14T08:39:47+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="The Python Packaging"><meta name=twitter:description content="名字 Python的模块或者包名应该遵循下面几条:
总是小写 pypi上唯一 不要用中划线分隔，下划线或者干脆不要分隔单词 最小结构 jay_hello/ jay_hello/ __init__."><meta name=generator content="Hugo 0.121.1"><link rel="shortcut icon" href=https://laujay.com/img/favicon.ico><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU=" crossorigin=anonymous><link rel=stylesheet href=https://laujay.com/fontawesome/css/all.min.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto+Slab|Ruda"><link rel=stylesheet type=text/css href=https://laujay.com/css/styles.css></head><body><div id=container><header><h1><a href=https://laujay.com/>世界的过客</a></h1><ul id=social-media><li><a href=https://github.com/lau-jay title=GitHub><i class="fab fa-github fa-lg"></i></a></li></ul><p><em>每个人获得的东西都恰好是他值得获得的东西</em></p></header><nav><ul><li><a href=https://laujay.com/about><i class="fa-li fa fa-lg"></i><span>About</span></a></li><li><a href=https://laujay.com/categories><i class="fa-li fa fa-lg"></i><span>Categories</span></a></li><li><a href=https://laujay.com/tags><i class="fa-li fa fa-lg"></i><span>Tags</span></a></li></ul></nav><main><article><h1>The Python Packaging</h1><aside><ul><li><time class=post-date datetime=2020-05-14T08:39:47+08:00>May 14, 2020</time></li><li>Categories:
<em><a href=https://laujay.com/categories/python>python</a></em></li><li><em><a href=https://laujay.com/tags/tool>#tool</a>
,
<a href=https://laujay.com/tags/packaging>#packaging</a></em></li><li>One minute read</li></ul></aside><div class=featured_image><a href=https://laujay.com/posts/the-python-packaging/ title="The Python Packaging"><img src></a></div><h2 id=名字>名字</h2><p>Python的模块或者包名应该遵循下面几条:</p><ul><li>总是小写</li><li>pypi上唯一</li><li>不要用中划线分隔，下划线或者干脆不要分隔单词</li></ul><h2 id=最小结构>最小结构</h2><pre tabindex=0><code>jay_hello/
  jay_hello/
     __init__.py
  setup.py
</code></pre><p>假设，<code>__init__.py</code>文件里就一个hello_world</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>hello_world</span>():
</span></span><span style=display:flex><span>  print(<span style=color:#e6db74>&#34;hello world!&#34;</span>)
</span></span></code></pre></div><p>setup.py文件里应该是以下内容:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> setuptools <span style=color:#f92672>import</span> setup
</span></span><span style=display:flex><span>setup(name<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;jay_hello&#34;</span>,
</span></span><span style=display:flex><span>     version<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;0.0.1&#34;</span>,
</span></span><span style=display:flex><span>     description<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;just say hello&#34;</span>,
</span></span><span style=display:flex><span>     url<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;https://github.com/lau-jay/jay_hello&#34;</span>,
</span></span><span style=display:flex><span>     author<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Lau Jay&#34;</span>,
</span></span><span style=display:flex><span>     author_email<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;example@gamil.com&#34;</span>,
</span></span><span style=display:flex><span>     license<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;MIT&#39;</span>,
</span></span><span style=display:flex><span>     packages<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#34;jay_hello&#34;</span>],
</span></span><span style=display:flex><span>     zip_safe<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>)
</span></span></code></pre></div><p>现在可以通过下面这种方式安装</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>pip install . 
</span></span></code></pre></div><p>本地开发时建议使用下面这种，原因是其使用了软链接，你对代码文件的任何更改不再需要任何操作被使用</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>pip install -e .
</span></span></code></pre></div><p>packaging.python.org上的原文是: <code>in such a way that the project appears to be installed, but yet is still editable from the src tree</code></p><p>那么现在就可以在repl里导入使用了</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>python setup.py develop 
</span></span></code></pre></div><p>这个是<code>pip install -e .</code>底层实际执行的方法，会在<code>site-packages</code>里创建<code>.egg-link</code> 文件去链接源码目录</p><h2 id=pypi上发布>PyPI上发布</h2><h3 id=注册账户>注册账户</h3><p>略</p><h3 id=注册名字上传元数据以及创建包页面创建分发包并上传>注册名字，上传元数据以及创建包页面，创建分发包并上传</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>python setup.py register sdist upload
</span></span></code></pre></div><h2 id=安装包>安装包</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>pip install jay_hello
</span></span></code></pre></div><h2 id=setuppy>setup.py</h2><p>setup参数解析</p><h3 id=依赖>依赖</h3><p><code>install_requires</code>类型是字符串或者字符串列表，</p><p>ps: 19.0版本开始pip移除了对 <code>dependency_links</code> 的支持</p><h3 id=提供命令行>提供命令行</h3><p><code>entry_points</code>：这个参数允许Python函数直接注册为命令行工具，这个机制非常可以方便地提供程序的命令行工具</p><pre tabindex=0><code class=language-ptyhon data-lang=ptyhon>setup(
   ...
   entry_points = {
       &#34;console_scripts&#34;: [&#34;jayhello= jay_hello:hello_world&#34;],
   }
)
</code></pre><p><code>scripts</code> : 安装包的时候，setuptools会拷贝脚本到PATH，可以像Linux命令那样使用，这个字段指定的脚本不需要是Python脚本，任何可执行的都行, 假设增加了一个bin目录，并增加一个shell脚本</p><pre tabindex=0><code>setup(
   ...
   scripts=[&#34;/bin/run.sh&#34;]
)
</code></pre><h3 id=添加非代码文件>添加非代码文件</h3><p>如果是图像，数据表，文档等。为了让setuptools正确处理他们</p><p>需要添加个MANIFEST.in文件，例如：</p><pre tabindex=0><code>include README.md
include docs/*.md
</code></pre><p>为了启用这些，需要如下设置参数:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>setup(
</span></span><span style=display:flex><span>   <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>   include_package_data<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>
</span></span><span style=display:flex><span>)
</span></span></code></pre></div><p>更多参数请参见<a href=setuptools.readthedocs.io/en/latest/setuptools.html>stuptools文档</a></p></article><section class=post-nav><ul><li><a href=https://laujay.com/posts/the-pytest-path/><i class="fa fa-chevron-circle-left"></i> The Pytest Discovery</a></li><li><a href=https://laujay.com/posts/mq-rabbitmq/>MQ-RabbitMQ <i class="fa fa-chevron-circle-right"></i></a></li></ul></section><section class=comments-block><button id=show-comments style=display:none><i class="fa fa-comments"></i> Add/View Comments</button></section><section id=disqus_thread></section><script>(function(){if(window.location.hostname=="localhost")return;var t,n=!1,o="lau-jay",s=document.getElementById("show-comments"),i=!0,a=null;if(a)return;s.style.display="",i?e():s.addEventListener("click",e,!1);function e(){if(!n){n=!0;var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//"+o+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e),document.getElementById("show-comments").style.display="none"}}t=window.location.hash.substr(1),t.length>8&&t.substring(0,8)=="comment-"&&e(),/bot|google|baidu|bing|msn|duckduckgo|slurp|yandex/i.test(navigator.userAgent)&&e()})()</script></main><footer><h6>Copyright © 2016 ~ 2023 - Jay Lau|Theme by <a href=https://github.com/funkydan2/hugo-kiera>kiera</a> |
Rendered by <a href=https://gohugo.io title=Hugo>Hugo</a> |
<a href=https://laujay.com/index.xml>Subscribe</a></h6></footer></div><script src=https://laujay.com/js/scripts.js></script><script>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-91611718-2","auto"),ga("send","pageview"))</script></body></html>