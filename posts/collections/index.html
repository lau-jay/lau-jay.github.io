<!doctype html><html lang=zh-CN><head><title>Collections - 世界的过客</title>
<meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="The HTML5 Herald"><meta name=author content="Jay Lau"><meta property="og:title" content="Collections"><meta property="og:description" content="collections module collections提供了些新类型：deque和defaultdict, namedtuple等。"><meta property="og:type" content="article"><meta property="og:url" content="https://laujay.com/posts/collections/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2016-11-29T23:35:32+08:00"><meta property="article:modified_time" content="2016-11-29T23:35:32+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Collections"><meta name=twitter:description content="collections module collections提供了些新类型：deque和defaultdict, namedtuple等。"><meta name=generator content="Hugo 0.121.1"><link rel="shortcut icon" href=https://laujay.com/img/favicon.ico><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU=" crossorigin=anonymous><link rel=stylesheet href=https://laujay.com/fontawesome/css/all.min.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto+Slab|Ruda"><link rel=stylesheet type=text/css href=https://laujay.com/css/styles.css></head><body><div id=container><header><h1><a href=https://laujay.com/>世界的过客</a></h1><ul id=social-media><li><a href=https://github.com/lau-jay title=GitHub><i class="fab fa-github fa-lg"></i></a></li></ul><p><em>每个人获得的东西都恰好是他值得获得的东西</em></p></header><nav><ul><li><a href=https://laujay.com/about><i class="fa-li fa fa-lg"></i><span>About</span></a></li><li><a href=https://laujay.com/categories><i class="fa-li fa fa-lg"></i><span>Categories</span></a></li><li><a href=https://laujay.com/tags><i class="fa-li fa fa-lg"></i><span>Tags</span></a></li></ul></nav><main><article><h1>Collections</h1><aside><ul><li><time class=post-date datetime=2016-11-29T23:35:32+08:00>Nov 29, 2016</time></li><li>Categories:
<em><a href=https://laujay.com/categories/python>python</a></em></li><li><em><a href=https://laujay.com/tags/stdlib>#stdlib</a></em></li><li>One minute read</li></ul></aside><div class=featured_image><a href=https://laujay.com/posts/collections/ title=Collections><img src></a></div><h2 id=collections-module>collections module</h2><p>collections提供了些新类型：deque和defaultdict, namedtuple等。</p><h2 id=deque>deque</h2><p>deque是性能非常高的，插入和删除优化到接近O(1),并且具有很有意思的特性。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>   <span style=color:#f92672>from</span> collections <span style=color:#f92672>import</span> deque
</span></span><span style=display:flex><span>   dq <span style=color:#f92672>=</span> deque([<span style=color:#ae81ff>1</span>,<span style=color:#ae81ff>2</span>],<span style=color:#ae81ff>12</span>)
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>3</span>,<span style=color:#ae81ff>15</span>):
</span></span><span style=display:flex><span>       dq<span style=color:#f92672>.</span>append(i) <span style=color:#75715e>#添加到右端</span>
</span></span><span style=display:flex><span>   id(dq[<span style=color:#ae81ff>0</span>]) <span style=color:#75715e>#4297546624</span>
</span></span><span style=display:flex><span>   id(dq[<span style=color:#ae81ff>1</span>]) <span style=color:#75715e>#4297546656</span>
</span></span><span style=display:flex><span>   dq<span style=color:#f92672>.</span>append(<span style=color:#ae81ff>18</span>)
</span></span><span style=display:flex><span>   id(dq[<span style=color:#ae81ff>0</span>]) <span style=color:#75715e>#4297546656</span>
</span></span></code></pre></div><p>用id来看添加值前后的内存地址会发现现的一个有意思的地方, 如果限制了大小，当满了以后那么添加新项目的话，会在相反的一端删除对象，添加了一个值后dq[0]的id变成了原来dq[1]的id值, 原来dq[0]里面的内容也被删除了, 这样的实现无疑保证了性能。</p><p>deque是双端队列，在插入的时侯性能极好并且deque是线程安全的，appendleft和append是用来分别在左端和右端添加数据。</p><p>还有个基于双端数据结构的函数：rotate, 它可以轻易的旋转所有项，rotate的参数
值大小决定旋转步数，正负决定旋转方向, 正向右转，负向左转。</p><h2 id=defaultdict>defaultdict</h2><p>与字典基本一样，除了对不存在的键将调用default_factory提供的函数来提供默认值，实际上与字典get取值设置默认值类似，只不过换成key不存在设置该key的值，并将这个key与所调用函数生成的值保存起来.</p><h2 id=namedtuple>namedtuple</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>   <span style=color:#f92672>from</span> collections <span style=color:#f92672>import</span> namedtuple
</span></span><span style=display:flex><span>   NetAddress <span style=color:#f92672>=</span> nametuple(<span style=color:#e6db74>&#39;NetAddress&#39;</span>, [<span style=color:#e6db74>&#39;hostname&#39;</span>,<span style=color:#e6db74>&#39;port&#39;</span>])
</span></span><span style=display:flex><span>   a <span style=color:#f92672>=</span> NetAddress(<span style=color:#e6db74>&#39;localhost&#39;</span>,<span style=color:#ae81ff>80</span>)
</span></span><span style=display:flex><span>   a<span style=color:#f92672>.</span>hostname <span style=color:#75715e># &#39;localhost&#39;</span>
</span></span><span style=display:flex><span>   a<span style=color:#f92672>.</span>port <span style=color:#75715e># 80</span>
</span></span><span style=display:flex><span>   type(a) <span style=color:#75715e># ipython output __main__.NetAddress </span>
</span></span><span style=display:flex><span>   isinstance(a, tuple) <span style=color:#75715e># True</span>
</span></span></code></pre></div><p>其实是构造了一个tuple的子类, 可以使用各种tuple的方法，但却提供了更方便的数据结构，isinstance验证了这点。
namedtuple具备更小的内存消耗，但是.方式的属性访问没类快。</p><h2 id=源码>源码</h2><p>有个点得记下，看collections的源码的时候发现，其使用了个_collections模块, 在标准库根本找不到，后来在爆站找到答案，居然是个内置库，c写的。</p></article><section class=post-nav><ul><li><a href=https://laujay.com/posts/glob/><i class="fa fa-chevron-circle-left"></i> glob</a></li><li><a href=https://laujay.com/posts/functools/>Functools <i class="fa fa-chevron-circle-right"></i></a></li></ul></section><section class=comments-block><button id=show-comments style=display:none><i class="fa fa-comments"></i> Add/View Comments</button></section><section id=disqus_thread></section><script>(function(){if(window.location.hostname=="localhost")return;var t,n=!1,o="lau-jay",s=document.getElementById("show-comments"),i=!0,a=null;if(a)return;s.style.display="",i?e():s.addEventListener("click",e,!1);function e(){if(!n){n=!0;var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//"+o+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e),document.getElementById("show-comments").style.display="none"}}t=window.location.hash.substr(1),t.length>8&&t.substring(0,8)=="comment-"&&e(),/bot|google|baidu|bing|msn|duckduckgo|slurp|yandex/i.test(navigator.userAgent)&&e()})()</script></main><footer><h6>Copyright © 2016 ~ 2023 - Jay Lau|Theme by <a href=https://github.com/funkydan2/hugo-kiera>kiera</a> |
Rendered by <a href=https://gohugo.io title=Hugo>Hugo</a> |
<a href=https://laujay.com/index.xml>Subscribe</a></h6></footer></div><script src=https://laujay.com/js/scripts.js></script><script>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-91611718-2","auto"),ga("send","pageview"))</script></body></html>