---
title: ASGI规范中文版
date: 2018-10-17 07:00:39
categories: python
tags: python3
---
# ASGI(Asynchronous Server Gateway Interface) Specification
*Version*:2.0(2017-11-28)

## 摘要

本文档描述了基于网络协议服务器（尤其是web服务器）和 Python 应用之间的标准接口，希望能够处理多种通用协议(包括 HTTP、HTTP2 和 WebSocket)。

这个基本规范目的在于定义这些服务器交互并运行应用的API集合；每个支持的协议（例如HTTP) 都有一个子规范，概述如何将协议编码和解码成信息。

## 依据

WSGI 规范自诞生以来应用广泛，让 Python 框架和 web 服务的选择上有很大的自由。然而，因为设计的与 HTTP 风格的请求响应模型的耦合太强，加上越来越多不遵循这种模式的协议逐渐成为 web 编程的标准之一，比如说，WebSocket。
ASGI 尝试在保证应用接口简单的前提下，提供一个允许数据能够在任意时候、被任意应用进程发送和接受的抽象。

它同样采用将协议转换为Python兼容，异步友好的消息集的原则，并将其概括为两部分：一个关于构建服务器的标准通信接口，以及一组用于每个协议的标准通信协议。

它主要的目标是提供一个编程HTTP/2 和WebSocket，以及一般的HTTP应用代码的方式。然而，

这种设计一部分是确保有简单的途径来兼容现有的WSGI服务器与应用代码，为绝大多数依赖WSGI的Python web 项目提供一个继续运行的简单方式，这是很重要的一点。具体的细节在ASGI-HTTP规范里描述。

## 总览

ASGI由两个不同的组件组成

* 一个*协议服务* ，其用来终止sockets与转换他们成为一个连接于每个链接的事件信息
* 一个*应用代码* ，它位于协议服务内，每个链接都会实例化一次，并在事件发生时进行处理

与WSGI类似的是，应用运行于服务容器中，服务容器以标准格式向应用发送请求。然而与WSGI不同的是，应用是实例化的对象，他们是处理事件，而非简单可调用的，并且他们必须是兼容`asyncio`的协程（在主线程上，如果需要运行同步的代码，可以自由的使用线程或其他进程）

与WSGI不同的是，一个ASGI有两个独立的链接部分：

* *链接周期* ，代表着一个协议链接到一个用户，并持续到链接被关闭
* 事件，发生在链接时发送给应用

应用在一个链接周期内被实例化，然后在事件循环中被触发执行处理事件，最后发送数据给客户端。

每个应用实例都映射到一个独立的“socket”或者链接，如果要进行清理操作，预计会在该链接的生命周期再加一段时间。 有些协议可能不使用传统的套接字; ASGI针对这些协议将定义范对应的（实例）生命周期以及何时关闭。