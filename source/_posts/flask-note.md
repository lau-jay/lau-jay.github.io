---
title: flask-note
date: 2017-07-21 22:22:04
tags: flask
---

## 请求与响应
Flask接收到一个请求时候，要让View能够访问一些对象才能处理请求。View需要知道的信息包括但不限于请求URL,参数等。只有获取到需要的信息, 才能够正确运行。

最符合直觉的做法是直接传入一个包含所有所需的信息的对象，这样View就能从该对象获取所有的信息了。但是这样会增加视图函数的参数数目，即使并不需要使用，但是众多的method里总有会使用的到的。

另外一种直观的做法是全局变量，这样无论哪里都可以访问，但与全局变量又不同，这样一来会互相干扰，而作为响应请求的服务端来说，不可能只有一个请求的。

threading.local这个概念是个很好的参考对象，可以实现多线程访问某个变量的时候只看到自己的数据。其原理很简单，维护一个字典，线程id与数据相对应。

Falsk 使用上下文让特定的变量在一个线程中全局 可访问，与此同时却不会干扰其他线程。

### 请求上下文(request context)
request context演化出request和session
```
 request  请求上下文 请求对象，封装了客户端发出的 HTTP 请求中的内容
 session  请求上下文 用户会话，用于存储请求之间需要“记住”的值的词典
```

Flask在分发请求前激活请求上下文(还有程序上下文), 请求处理完成后再删除。请求上文文被激活后, 就可以使用
request和session变量。

### 请求钩子

- before_first_request: 注册一个函数，在处理第一个请求之前运行。
- before_request: 注册一个函数，在每次请求之前运行。
- after_request: 注册一个函数，如果没有未处理的异常抛出，在每次请求后运行。



[flask源码解析:上下文](http://cizixs.com/2017/01/13/flask-insight-context)
